<div class="panel-container">
  <div class="panel-header">
    <h1>Ä°ÅŸletme Paneli</h1>
    <button class="logout-btn" (click)="logout()">Ã‡Ä±kÄ±ÅŸ Yap</button>
  </div>

  <!-- Tab MenÃ¼sÃ¼ -->
  <div class="tab-menu">
    <button [class.active]="aktifTab === 'genel'" (click)="aktifTab = 'genel'">Genel Bilgiler</button>
    <button [class.active]="aktifTab === 'calisanlar'" (click)="aktifTab = 'calisanlar'">Ã‡alÄ±ÅŸanlar</button>
    <button [class.active]="aktifTab === 'randevular'" (click)="aktifTab = 'randevular'">Randevular</button>
  </div>

  <!-- GENEL BÄ°LGÄ°LER TAB -->
  <div class="tab-content" *ngIf="aktifTab === 'genel'">
    <ng-container *ngIf="isletme">
      <!-- GÃ¶rÃ¼ntÃ¼leme Modu -->
      <div class="isletme-info" *ngIf="!duzenlemeModu">
        <div class="info-header">
          <div class="foto-container">
            <div class="isletme-foto" (click)="fotografSec()">
              <img *ngIf="getFotoUrl()" [src]="getFotoUrl()" alt="Ä°ÅŸletme FotoÄŸrafÄ±">
              <div *ngIf="!getFotoUrl()" class="foto-placeholder">
                <span>ğŸ“·</span>
              </div>
              <div class="foto-overlay">
                <span>ğŸ“· DeÄŸiÅŸtir</span>
              </div>
            </div>
            <input type="file" id="fotografInput" accept="image/*" (change)="onFileSelected($event)" style="display: none;">

            <!-- SeÃ§ilen dosya bilgisi -->
            <div class="selected-file" *ngIf="selectedFile">
              <span>{{ selectedFile.name }}</span>
              <button class="upload-btn" (click)="fotografGuncelle()" [disabled]="fotografYukleniyor">
                {{ fotografYukleniyor ? 'YÃ¼kleniyor...' : 'â¬†ï¸ YÃ¼kle' }}
              </button>
            </div>
          </div>
          <button class="edit-btn" (click)="duzenlemeyiBaslat()">âœï¸ DÃ¼zenle</button>
        </div>
        <h2>{{ isletme!.isim }}</h2>
        <p><strong>ID:</strong> {{ isletmeId }}</p>
        <p *ngIf="isletme!.telefon"><strong>Telefon:</strong> {{ isletme!.telefon }}</p>
        <p *ngIf="isletme!.adres"><strong>Adres:</strong> {{ isletme!.adres }}</p>
        <p *ngIf="isletme!.kategori"><strong>Kategori:</strong> {{ isletme!.kategori }}</p>
        <p *ngIf="isletme!.zaman_artisi"><strong>Zaman ArtÄ±ÅŸÄ±:</strong> {{ isletme!.zaman_artisi }} dakika</p>
      </div>

      <!-- DÃ¼zenleme Modu -->
      <div class="isletme-info edit-mode" *ngIf="duzenlemeModu">
        <h3>Ä°ÅŸletme Bilgilerini DÃ¼zenle</h3>

        <div class="edit-form">
          <div class="form-group">
            <label>Ä°ÅŸletme AdÄ±</label>
            <input type="text" [(ngModel)]="duzenlemeVerisi.isim" placeholder="Ä°ÅŸletme AdÄ±">
          </div>

          <div class="form-group">
            <label>Telefon</label>
            <input type="tel" [(ngModel)]="duzenlemeVerisi.telefon" placeholder="Telefon">
          </div>

          <div class="form-group">
            <label>Adres</label>
            <input type="text" [(ngModel)]="duzenlemeVerisi.adres" placeholder="Adres">
          </div>

          <div class="form-group">
            <label>Kategori</label>
            <select [(ngModel)]="duzenlemeVerisi.kategori">
              <option value="">SeÃ§iniz</option>
              <option value="Berber">Berber</option>
              <option value="KuafÃ¶r">KuafÃ¶r</option>
              <option value="GÃ¼zellik Salonu">GÃ¼zellik Salonu</option>
              <option value="Oto YÄ±kama">Oto YÄ±kama</option>
              <option value="DiÄŸer">DiÄŸer</option>
            </select>
          </div>

          <div class="form-group">
            <label>Zaman ArtÄ±ÅŸ MiktarÄ± (dakika)</label>
            <input type="number" [(ngModel)]="duzenlemeVerisi.zaman_artisi" placeholder="Ã–rn: 30" min="5" max="240">
          </div>

          <div class="form-group">
            <label>Yeni Åifre (opsiyonel, min 6 karakter)</label>
            <input type="password" [(ngModel)]="duzenlemeVerisi.parola" placeholder="Yeni ÅŸifre bÄ±rakÄ±n veya deÄŸiÅŸtirin">
          </div>

          <div class="form-actions">
            <button class="cancel-btn" (click)="duzenlemeyiIptal()">Ä°ptal</button>
            <button class="save-btn" (click)="isletmeyiGuncelle()">Kaydet</button>
          </div>
        </div>
      </div>
    </ng-container>
  </div>

  <!-- Ã‡ALIÅANLAR TAB -->
  <div class="tab-content" *ngIf="aktifTab === 'calisanlar'">
    <div class="section-header">
      <h2>Ã‡alÄ±ÅŸanlar</h2>
      <button class="add-btn" (click)="calisanFormAcik = !calisanFormAcik">
        {{ calisanFormAcik ? 'Ä°ptal' : '+ Ã‡alÄ±ÅŸan Ekle' }}
      </button>
    </div>

    <!-- Ã‡alÄ±ÅŸan Ekleme Formu -->
    <div class="form-card" *ngIf="calisanFormAcik">
      <h3>Yeni Ã‡alÄ±ÅŸan</h3>
      <div class="form-row">
        <input type="text" [(ngModel)]="yeniCalisan.ad" placeholder="Ad">
        <input type="text" [(ngModel)]="yeniCalisan.soyad" placeholder="Soyad">
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>BaÅŸlangÄ±Ã§ Saati</label>
          <input type="time" [(ngModel)]="yeniCalisan.baslangic_saati">
        </div>
        <div class="form-group">
          <label>BitiÅŸ Saati</label>
          <input type="time" [(ngModel)]="yeniCalisan.bitis_saati">
        </div>
      </div>
      <button class="submit-btn" (click)="calisanEkle()">Kaydet</button>
    </div>

    <!-- Ã‡alÄ±ÅŸan Listesi -->
    <div class="list-container">
      <div class="list-item" *ngFor="let calisan of calisanlar">
        <div class="item-info">
          <strong>{{ calisan.ad }} {{ calisan.soyad }}</strong>
          <span class="item-detail">{{ calisan.baslangic_saati }} - {{ calisan.bitis_saati }}</span>
        </div>
      </div>
      <p *ngIf="calisanlar.length === 0" class="empty-message">HenÃ¼z Ã§alÄ±ÅŸan eklenmemiÅŸ.</p>
    </div>
  </div>

  <!-- RANDEVULAR TAB -->
  <div class="tab-content" *ngIf="aktifTab === 'randevular'">
    <div class="section-header">
      <h2>Randevular</h2>
    </div>

    <!-- Filtreler -->
    <div class="filters">
      <select [(ngModel)]="seciliDurum" (change)="randevulariYukle()">
        <option value="">TÃ¼m Durumlar</option>
        <option value="beklemede">Beklemede</option>
        <option value="onaylandi">OnaylandÄ±</option>
        <option value="iptal">Ä°ptal Edildi</option>
      </select>
      <input type="date" [(ngModel)]="seciliTarih" (change)="randevulariYukle()">
      <button class="refresh-btn" (click)="randevulariYukle()">Yenile</button>
    </div>

    <!-- Randevu Listesi -->
    <div class="list-container">
      <div class="randevu-item" *ngFor="let randevu of randevular"
           [class.beklemede]="randevu.durum === 'beklemede' && !randevuGecmisMi(randevu)"
           [class.onaylandi]="randevu.durum === 'onaylandi' && !randevuGecmisMi(randevu)"
           [class.iptal]="randevu.durum === 'iptal'"
           [class.gecmis]="randevuGecmisMi(randevu)">
        <div class="randevu-info">
          <div class="randevu-main">
            <strong>{{ formatRandevuTarih(randevu) }}</strong>
            <span class="durum-badge gecmis" *ngIf="randevuGecmisMi(randevu)">â° GeÃ§miÅŸ</span>
            <span class="durum-badge" *ngIf="!randevuGecmisMi(randevu)" [class.beklemede]="randevu.durum === 'beklemede'" [class.onaylandi]="randevu.durum === 'onaylandi'" [class.iptal]="randevu.durum === 'iptal'">{{ randevu.durum }}</span>
          </div>
          <div class="randevu-details">
            <span *ngIf="randevu.alan_kisi">ğŸ§‘ {{ randevu.alan_kisi }}</span>
            <span>ğŸ“ {{ randevu.telefon }}</span>
            <span>ğŸ‘¤ {{ randevu.calisan ? (randevu.calisan.ad + ' ' + randevu.calisan.soyad) : getCalisanAdi(randevu.calisan_id) }}</span>
          </div>
        </div>
        <div class="randevu-actions" *ngIf="randevu.durum === 'beklemede'">
          <button class="approve-btn" (click)="randevuOnayla(randevu.id || randevu.randevu_id)">âœ“ Onayla</button>
          <button class="reject-btn" (click)="randevuIptal(randevu.id || randevu.randevu_id)">âœ• Ä°ptal</button>
        </div>
        <div class="randevu-actions" *ngIf="randevu.durum === 'iptal'">
          <button class="approve-btn" (click)="randevuOnayla(randevu.id || randevu.randevu_id)">âœ“ Onayla</button>
          <button class="pending-btn" (click)="randevuBeklemedeYap(randevu.id || randevu.randevu_id)">â³ Beklemeye Al</button>
          <button class="delete-btn" (click)="randevuSil(randevu.id || randevu.randevu_id)">ğŸ—‘ Sil</button>
        </div>
        <div class="randevu-actions" *ngIf="randevu.durum === 'onaylandi'">
          <button class="pending-btn" (click)="randevuBeklemedeYap(randevu.id || randevu.randevu_id)">â³ Beklemeye Al</button>
          <button class="reject-btn" (click)="randevuIptal(randevu.id || randevu.randevu_id)">âœ• Ä°ptal</button>
          <button class="delete-btn" (click)="randevuSil(randevu.id || randevu.randevu_id)">ğŸ—‘ Sil</button>
        </div>
      </div>
      <p *ngIf="randevular.length === 0" class="empty-message">Randevu bulunamadÄ±.</p>
    </div>
  </div>

  <div *ngIf="!isletme && aktifTab === 'genel'" class="no-data">
    <p>Ä°ÅŸletme bilgisi yÃ¼kleniyor...</p>
  </div>
</div>
